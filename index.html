<!DOCTYPE html>
<html lang="ky">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MPA Business System</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#0d47a1;
 --card:#ffffff;
 --text:#000;
}

body.dark{
 --bg:#0f172a;
 --card:#1e293b;
 --text:#fff;
}

body{
margin:0;
font-family:Arial;
background:var(--bg);
color:var(--text);
}

header{
background:#081c3a;
color:white;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
}

button{
cursor:pointer;
}

nav{
display:none;
flex-direction:column;
background:var(--card);
padding:10px;
}

nav button{
margin:5px 0;
padding:8px;
}

section{
display:none;
padding:15px;
background:var(--card);
margin:10px;
border-radius:8px;
color:var(--text);
}

.active{display:block;}

input,select{
width:100%;
padding:8px;
margin:5px 0;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
border:1px solid gray;
padding:5px;
text-align:center;
}
</style>
</head>

<body>

<header>
<div><b>MPA Business System</b></div>
<div>
<button onclick="toggleTheme()">ğŸŒ™</button>
<button onclick="toggleMenu()">â˜°</button>
</div>
</header>

<nav id="menu">
<button onclick="show('dashboard')">ğŸ“Š Ğ‘Ğ°ÑˆĞºÑ‹</button>
<button onclick="show('machines')">ğŸš› ĞœĞ°ÑˆĞ¸Ğ½Ğ°</button>
<button onclick="show('operations')">â›½ ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ</button>
<button onclick="show('report')">ğŸ“„ ĞÑ‚Ñ‡ĞµÑ‚</button>
</nav>

<section id="login" class="active">
<h3>ğŸ” ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ</h3>
<input type="password" id="password" placeholder="ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ">
<button onclick="login()">ĞšĞ¸Ñ€Ò¯Ò¯</button>
</section>

<section id="dashboard">
<h3>ğŸ“Š Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº</h3>
<button onclick="updateChart('day')">ĞšÒ¯Ğ½</button>
<button onclick="updateChart('month')">ĞĞ¹</button>
<canvas id="chart"></canvas>
</section>

<section id="machines">
<h3>ğŸš› ĞœĞ°ÑˆĞ¸Ğ½Ğ° ĞºĞ¾ÑˆÑƒÑƒ</h3>
<input type="text" id="carName" placeholder="ĞœĞ°ÑˆĞ¸Ğ½Ğ°">
<button onclick="addMachine()">ĞšĞ¾ÑˆÑƒÑƒ</button>
<div id="machineList"></div>
</section>

<section id="operations">
<h3>â›½ ĞĞ»Ğ´Ñ‹ / Ğ¡Ğ°Ñ‚Ñ‚Ñ‹</h3>
<select id="machineSelect"></select>
<select id="type">
<option value="buy">ĞĞ»Ğ´Ñ‹</option>
<option value="sell">Ğ¡Ğ°Ñ‚Ñ‚Ñ‹</option>
</select>
<input type="number" id="liters" placeholder="Ğ›Ğ¸Ñ‚Ñ€">
<input type="number" id="price" placeholder="Ğ‘Ğ°Ğ°ÑÑ‹">
<button onclick="addOperation()">Ğ¡Ğ°ĞºÑ‚Ğ¾Ğ¾</button>
</section>

<section id="report">
<h3>ğŸ“„ ĞĞ¹Ğ»Ñ‹Ğº ĞÑ‚Ñ‡ĞµÑ‚</h3>
<div id="reportTable"></div>
</section>

<script>

let password = localStorage.getItem("password") || "1";
let machines = JSON.parse(localStorage.getItem("machines")) || [];
let operations = JSON.parse(localStorage.getItem("operations")) || [];

function save(){
localStorage.setItem("machines",JSON.stringify(machines));
localStorage.setItem("operations",JSON.stringify(operations));
localStorage.setItem("password",password);
}

function login(){
let p=document.getElementById("password").value;
if(p===password){
document.getElementById("login").classList.remove("active");
show("dashboard");
}else{
alert("Ğ¢ÑƒÑƒÑ€Ğ° ÑĞ¼ĞµÑ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ!");
}
}

function toggleMenu(){
let m=document.getElementById("menu");
m.style.display=(m.style.display==="flex")?"none":"flex";
}

function show(id){
document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

function toggleTheme(){
document.body.classList.toggle("dark");
}

function addMachine(){
let name=document.getElementById("carName").value;
if(!name) return;
machines.push({name});
save();
renderMachines();
}

function renderMachines(){
let list=document.getElementById("machineList");
let select=document.getElementById("machineSelect");
list.innerHTML="";
select.innerHTML="";
machines.forEach((m,i)=>{
list.innerHTML+="<div>"+m.name+"</div>";
select.innerHTML+=`<option value="${i}">${m.name}</option>`;
});
}

function addOperation(){
let machine=document.getElementById("machineSelect").value;
let type=document.getElementById("type").value;
let liters=Number(document.getElementById("liters").value);
let price=Number(document.getElementById("price").value);

let date=new Date();
let month=date.getFullYear()+"-"+(date.getMonth()+1);

operations.push({machine,type,liters,price,date:date.toLocaleString(),month});
save();
updateChart("month");
updateReport();
}

let chart;

function updateChart(mode){

let labels=[];
let dataBuy=[];
let dataSell=[];

let filtered=operations;

if(mode==="month"){
let current=new Date().getFullYear()+"-"+(new Date().getMonth()+1);
filtered=operations.filter(o=>o.month===current);
}

filtered.forEach(o=>{
let sum=o.liters*o.price;
if(o.type==="buy"){
dataBuy.push(sum);
dataSell.push(0);
}else{
dataSell.push(sum);
dataBuy.push(0);
}
labels.push(o.date);
});

let ctx=document.getElementById("chart").getContext("2d");

if(chart) chart.destroy();

chart=new Chart(ctx,{
type:"bar",
data:{
labels:labels,
datasets:[
{
label:"ĞšĞ¸Ñ€ĞµÑˆĞµ",
backgroundColor:"green",
data:dataSell
},
{
label:"Ğ§Ñ‹Ğ³Ğ°ÑˆĞ°",
backgroundColor:"red",
data:dataBuy
}
]
}
});
}

function updateReport(){
let report=document.getElementById("reportTable");
let current=new Date().getFullYear()+"-"+(new Date().getMonth()+1);

let buy=0,sell=0;

operations.forEach(o=>{
if(o.month===current){
if(o.type==="buy") buy+=o.liters*o.price;
if(o.type==="sell") sell+=o.liters*o.price;
}
});

report.innerHTML=`
<table>
<tr><th>ĞĞ¹</th><th>ĞĞ»Ğ´Ñ‹</th><th>Ğ¡Ğ°Ñ‚Ñ‚Ñ‹</th><th>Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ</th></tr>
<tr>
<td>${current}</td>
<td>${buy}</td>
<td>${sell}</td>
<td>${sell-buy}</td>
</tr>
</table>
`;
}

renderMachines();
updateChart("month");
updateReport();

</script>

</body>
</html>
